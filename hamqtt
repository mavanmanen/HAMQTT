#!/bin/bash

# 1. Check if PowerShell Core is installed
if ! command -v pwsh &> /dev/null; then
    echo "‚ùå PowerShell Core (pwsh) is not installed."
    echo "   Please install it to run these tools."
    echo ""
    echo "   --- Installation Options ---"
    echo "   macOS (Homebrew):   brew install --cask powershell"
    echo "   Ubuntu/Debian:      sudo apt-get install -y powershell"
    echo "   Fedora/RHEL:        sudo dnf install -y powershell"
    echo "   Arch Linux:         sudo pacman -S powershell"
    echo "   Snap (Universal):   sudo snap install powershell --classic"
    echo "   Dotnet Global Tool: dotnet tool install --global PowerShell"
    exit 1
fi

# 2. Resolve Script Directory
# Ensures we find hamqtt.ps1 even if called from another folder
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# 3. Pass execution to PowerShell script
# "$@" passes all arguments provided to this script
pwsh -NoProfile -ExecutionPolicy Bypass -File "$SCRIPT_DIR/hamqtt.ps1" "$@"